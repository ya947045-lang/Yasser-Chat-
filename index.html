<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>Login</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="manifest" href="manifest.json">
</head>
<body class="center">

<div class="card">
  <h2>تسجيل دخول</h2>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="password" placeholder="Password">
  <button onclick="register()">إنشاء حساب</button>
  <button onclick="login()">دخول</button>
  <p id="msg"></p>
</div>

<button id="installBtn" style="display:none;">تثبيت التطبيق</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword }
from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyDLm_HUbnNfRv4ZH9u08VQi7pmZzm1GgRk",
  authDomain: "yasser-chat-6c39c.firebaseapp.com",
  projectId: "yasser-chat-6c39c",
  storageBucket: "yasser-chat-6c39c.firebasestorage.app",
  messagingSenderId: "141483029088",
  appId: "1:141483029088:web:49c20f6f027be755bbc905"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);

const emailInput = document.getElementById("email");
const passwordInput = document.getElementById("password");
const msg = document.getElementById("msg");

window.register = async () => {
  try {
    await createUserWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    location.href = "chat.html";
  } catch (e) { msg.innerText = e.message; }
};

window.login = async () => {
  try {
    await signInWithEmailAndPassword(auth, emailInput.value, passwordInput.value);
    location.href = "chat.html";
  } catch (e) { msg.innerText = e.message; }
};

// PWA install
let deferredPrompt;
const installBtn = document.getElementById("installBtn");

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  installBtn.style.display = "block";
});

installBtn.addEventListener('click', async () => {
  installBtn.style.display = "none";
  deferredPrompt.prompt();
  deferredPrompt = null;
});

// Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js');
}
</script>
</body>
</html>
