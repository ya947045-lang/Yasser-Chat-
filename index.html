<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>شات فشيخ</title>
<link rel="stylesheet" href="style.css">
<script type="module" src="firebaseConfig.js"></script>
</head>
<body>
<div class="login-container">
  <h1>أدخل اسمك</h1>
  <input type="text" id="username" placeholder="اسمك">
  <button id="loginBtn">دخول</button>
</div>

<script type="module">
import { db, auth } from "./firebaseConfig.js";
import { collection, addDoc, doc, setDoc } from "firebase/firestore";
import { signInAnonymously } from "firebase/auth";

const loginBtn = document.getElementById("loginBtn");
loginBtn.addEventListener("click", async () => {
  const username = document.getElementById("username").value.trim();
  if(!username) return alert("اكتب اسمك يا فشيخ");

  // تسجيل دخول مجهول
  const userCredential = await signInAnonymously(auth);
  const uid = userCredential.user.uid;

  // إضافة المستخدم لـ users
  await setDoc(doc(db, "users", uid), {
    name: username,
    online: true
  });

  // احفظ الـ UID في localStorage عشان صفحة الشات تعرفه
  localStorage.setItem("uid", uid);
  localStorage.setItem("name", username);

  // روح لصفحة الشات
  window.location.href = "chat.html";
});
</script>
</body>
</html>
